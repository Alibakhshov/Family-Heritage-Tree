<!DOCTYPE html>
{% load static %}
<html lang="zxx">

<head>
   <!-- Page Title -->
   <title>RootsLink | Roots</title>

   <!-- Meta Data -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="">
   <meta name="keywords" content="">

   <!-- Favicon -->
   <link rel="shortcut icon" href="{% static 'img/logo (ai).png' %}">

   <!-- Web Fonts -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

   
   <!-- ======= BEGIN GLOBAL MANDATORY STYLES ======= -->
   <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
   <link rel="stylesheet" href="{% static 'fonts/icofont/icofont.min.css' %}">
   <link rel="stylesheet" href="{% static 'plugins/perfect-scrollbar/perfect-scrollbar.min.css' %}">
   <!-- ======= END BEGIN GLOBAL MANDATORY STYLES ======= -->
   
   <!-- ======= BEGIN PAGE LEVEL PLUGINS STYLES ======= -->
   <link rel="stylesheet" href="{% static 'plugins/bootstrap-datepicker/bootstrap-datepicker.min.css' %}">
   <!-- ======= END BEGIN PAGE LEVEL PLUGINS STYLES ======= -->

   <!-- ======= MAIN STYLES ======= -->
   <link rel="stylesheet" href="{% static 'css/style.css' %}">
   <!-- ======= END MAIN STYLES ======= -->

</head>

<body>

   <!-- Offcanval Overlay -->
   <div class="offcanvas-overlay"></div>
   <!-- Offcanval Overlay -->

   <!-- Wrapper -->
   <div class="wrapper">
      <!-- Header -->
      {% include 'core/partials/header.html' %}
      <!-- End Header -->

      <!-- Main Wrapper -->
      <div class="main-wrapper">
         <!-- Sidebar -->
         {% include 'core/partials/sidebar.html' %}
         <!-- End Sidebar -->

         <!-- Main Content -->
         <div class="main-content d-flex flex-column flex-md-row">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-12">
                    <!-- Card -->
                    <div class="card bg-transparent">
                        <!-- Contact Header -->
                        <div class="contact-header d-flex align-items-sm-center media flex-column flex-sm-row bg-white mb-30">
                           <div class="contact-header-left media-body d-flex align-items-center mr-4">
                                 <!-- Add New Contact Btn -->
                                 <div class="add-new-contact mr-20">
                                       <a href="{% url 'roots_grid' %}" class="btn-circle">
                                          <img src="{% static 'img/svg/grid-icon.svg' %}" alt="" class="svg">
                                       </a>
                                 </div>
                                 <!-- End Add New Contact Btn -->

                                 <div class="heading">
                                    <h3 class="c2">Family Members</h3>
                                </div>

                                 
                           </div>

                           
                        </div>
                        <!-- End Contact Header -->


                        <div class="table-responsive">
                            <!-- Invoice List Table -->
                            <table class="contact-list-table text-nowrap bg-white">
                              <thead>
                                  <tr>
                                      
                                      <th ><i class="icofont-ui-user"></i> Full name </th>
                                      <th><i class="icofont-email"></i> Email</th>
                                      <th><i class="icofont-phone"></i> Phone</th>
                                      <th><i class="icofont-users-alt-4"></i> Gender</th>
                                      <th><i class="icofont-birthday-cake"></i> Birth date</th>
                                      <th><i class="icofont-ui-calendar"></i> Days until birthday</th>
                                      <th><i class="icofont-calendar"></i> Joining Date </th>
                                      <th><i class="icofont-calendar"></i> Updated at </th>
                                      <!-- <th>Actions</th> -->
                                  </tr>
                              </thead>
                              <tbody>
                                 {% for person in people %}
                                 <tr data-id="{{ person.id }}">
                                    <td data-field="name">{{ person.name }} {{ person.surname }}</td>
                                    <td data-field="email">{{ person.email }}</td>
                                    <td data-field="phone">{{ person.phone }}</td>
                                    <td data-field="relationship">{{ person.gender }}</td>
                                    <td data-field="date_of_birth">{{ person.date_of_birth }}</td>
                                    <td data-field="days_until_birthday">{{ person.days_until_birthday }}</td>
                                    <td>{{ person.created_at|date:"F d, Y" }}</td>
                                    <td>{{ person.updated_at|date:"F d, Y" }}</td>
                                    <!-- <td class="actions">
                                       <span class="contact-edit" onclick="toggleEditable(this)">
                                          <img src="{% static 'img/svg/c-edit.svg' %}" alt="" class="svg">
                                       </span>
                                       <span class="contact-close">
                                          <img src="{% static 'img/svg/c-close.svg' %}" alt="" class="svg">
                                       </span>
                                    </td> -->
                                 </tr>
                                 {% endfor %}
                             </tbody>
                             
                          </table>
                          
                            <!-- End Invoice List Table -->
                        </div>
                    </div>
                    <!-- End Card -->

                  </div>
               </div>
            </div>
         </div>
         <!-- End Main Content -->
      </div>
      <!-- End Main Wrapper -->

      <!-- Footer -->
      {% include 'core/partials/footer.html' %}
      <!-- End Footer -->
   </div>
   <!-- End wrapper -->
   

   <!-- ======= BEGIN GLOBAL MANDATORY SCRIPTS ======= -->
   <script src="{% static 'js/jquery.min.js' %}"></script>
   <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
   <script src="{% static 'plugins/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
   <script src="{% static 'js/script.js' %}"></script>
   <!-- ======= BEGIN GLOBAL MANDATORY SCRIPTS ======= -->

   <!-- ======= BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS ======= -->
   <script src="{% static 'plugins/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
   <script src="{% static 'plugins/bootstrap-datepicker/custom-datepicker.js' %}"></script>
   <!-- ======= End BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS ======= -->

   <script>
      function toggleEditable(span) {
        var row = span.closest('tr');
        var cells = row.querySelectorAll('td:not(.actions)');
        var actionsCell = row.querySelector('.actions');
        var isEditable = cells[0].getAttribute('contenteditable') === "true";

        // Toggle the editable state of each cell
        cells.forEach(function(cell) {
            cell.setAttribute('contenteditable', !isEditable);
            if (!isEditable) {
                cell.style.backgroundColor = "#f0f0f0";
                cell.style.border = "1px solid #ccc";
                cell.style.borderRadius = "8px";
                cell.style.padding = "4px";
            } else {
                cell.style.backgroundColor = "";
                cell.style.border = "";
                cell.style.borderRadius = "";
                cell.style.padding = "";
            }
        });

        // Toggle visibility of the edit and close spans
        var editSpan = actionsCell.querySelector('.contact-edit');
        var closeSpan = actionsCell.querySelector('.contact-close');
        editSpan.style.display = isEditable ? "inline-block" : "none";
        closeSpan.style.display = isEditable ? "inline-block" : "none";

        // Add or remove Save and Close buttons
        if (!isEditable) {
            var saveButton = document.createElement("button");
            saveButton.textContent = "Save";
            saveButton.className = "btn btn-sm btn-primary mr-2";
            saveButton.onclick = function() {
                saveEdits(row);
                toggleEditable(span);
            };
            actionsCell.appendChild(saveButton);

            var closeButton = document.createElement("button");
            closeButton.textContent = "Close";
            closeButton.className = "btn btn-sm btn-secondary";
            closeButton.onclick = function() {
                toggleEditable(span);
            };
            actionsCell.appendChild(closeButton);
        } else {
            // Remove the buttons when closing edit mode
            actionsCell.querySelectorAll("button").forEach(button => button.remove());
        }
    }

    function saveEdits(id) {
    // Extract the ID from the data-id attribute value of the tr element
    const extractedId = $(id).data('id');
    if (!extractedId) {
        console.error("Data-id attribute not found or empty.");
        return;
    }

    // Construct the data object with just the extracted ID
    const data = {
        "id": extractedId
    };

    // Send the data to the backend using AJAX
    $.ajax({
        url: `/save-roots/${extractedId}/`,
        type: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken')  // Assuming you have a function to get CSRF token
        },
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function(response) {
            console.log("Success:", response);
            // Handle success response if needed
        },
        error: function(xhr, textStatus, errorThrown) {
            console.error("Error saving data:", errorThrown);
            // Handle error if needed
        }
    });
}


   // Helper function to get CSRF token
   function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
         const cookies = document.cookie.split(';');
         for (let i = 0; i < cookies.length; i++) {
               const cookie = cookies[i].trim();
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
               }
         }
      }
      return cookieValue;
   }

   </script>
</body>

</html>