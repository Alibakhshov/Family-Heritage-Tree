<!DOCTYPE html>
{% load static %}
<html lang="zxx">

<head>
   <!-- Page Title -->
   <title>RootsLink | Dashboard</title>

   <!-- Meta Data -->
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="">
   <meta name="keywords" content="">

   <!-- Favicon -->
   <link rel="shortcut icon" href="{% static 'img/logo (ai).png' %}">

   <!-- Web Fonts -->
   <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&display=swap" rel="stylesheet">
   
   <!-- ======= BEGIN GLOBAL MANDATORY STYLES ======= -->
   <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
   <link rel="stylesheet" href="{% static 'fonts/icofont/icofont.min.css' %}">
   <link rel="stylesheet" href="{% static 'plugins/perfect-scrollbar/perfect-scrollbar.min.css' %}">
   <!-- ======= END BEGIN GLOBAL MANDATORY STYLES ======= -->
   
   <!-- ======= BEGIN PAGE LEVEL PLUGINS STYLES ======= -->
   <link rel="stylesheet" href="{% static 'plugins/apex/apexcharts.css' %}">
   <!-- ======= END BEGIN PAGE LEVEL PLUGINS STYLES ======= -->

   <!-- ======= MAIN STYLES ======= -->
   <link rel="stylesheet" href="{% static 'css/style.css' %}">
   <!-- ======= END MAIN STYLES ======= -->

   <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


</head>

<body>

   <!-- Offcanval Overlay -->
   <div class="offcanvas-overlay"></div>
   <!-- Offcanval Overlay -->

   <!-- Wrapper -->
   <div class="wrapper">

      <!-- Header -->
      {% include 'core/partials/header.html' %}
      <!-- End Header -->

      <!-- Main Wrapper -->
      <div class="main-wrapper">
         <!-- Sidebar -->
         {% include 'core/partials/sidebar.html' %}
         <!-- End Sidebar -->

         <!-- Main Content -->
         <div class="main-content">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-xl-3 col-sm-6">
                     <!-- Card -->
                     <div class="card mb-30">
                        <div class="state">
                           <div class="d-flex align-items-center flex-wrap">
                              <div class="state-icon d-flex justify-content-center" style="margin-left: -5px;">
                                  <img src="{% static 'img/png-icon/last_login.gif' %}" style="width: 60%;" alt="">
                              </div>
                              <div class="state-content">
                                  <p class="font-14 mb-2">Last login</p>
                                  <h3>{{ user.last_login|date:"j F, Y" }}</h3>
                              </div>
                           </div>
                        </div>
                     </div>
                     <!-- End Card -->
                  </div>

                  <div class="col-xl-3 col-sm-6">
                     <!-- Card -->
                     <div class="card mb-30">
                        <div class="state">
                           <div class="d-flex align-items-center flex-wrap">
                              <div class="state-icon d-flex justify-content-center" style="margin-left: -5px;">
                                  <img src="{% static 'img/png-icon/date_joined.gif' %}" style="width: 60%;" alt="">
                              </div>
                              <div class="state-content">
                                  <p class="font-14 mb-2">Date joined</p>
                                  <h3>{{ user.date_joined|date:"j F, Y" }}</h3>
                              </div>
                           </div>
                        </div>
                     </div>
                     <!-- End Card -->
                  </div>

                  <div class="col-xl-3 col-sm-6">
                     <!-- Card -->
                     <div class="card mb-30">
                        <div class="state">
                            <div class="d-flex align-items-center flex-wrap">
                                <div class="state-icon d-flex justify-content-center" style="margin-left: -5px;">
                                    <img src="{% static 'img/png-icon/family_members.gif' %}" style="width: 60%;" alt="">
                                </div>
                                <div class="state-content">
                                    <p class="font-14 mb-2">Total Members in a family</p>
                                    <h3>{{ total_members }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                     <!-- End Card -->
                  </div>

                  <div class="col-xl-3 col-sm-6">
                     <!-- Card -->
                     <div class="card mb-30">
                        <div class="state">
                           <div class="d-flex align-items-center flex-wrap">
                              <div class="state-icon d-flex justify-content-center" style="margin-left: -5px;">
                                 <img src="{% static 'img/png-icon/gender-identity.gif' %}" style="width: 60%;" alt="">
                             </div>

                             <div class="state-content">
                                 <p class="font-14 mb-2">Distribution by gender</p>
                                 <div class="gender-icons" style="display: flex;">
                                    <h3><span style="margin-right: 10px;"><i class="icofont-user-male"></i> {{ total_male }}</span></h3>
                                    <h3><span ><i class="icofont-user-female"></i> {{ total_female }}</span></h3>
                                 </div>
                              </div>
                          
                              
                           </div>
                        </div>
                     </div>
                     <!-- End Card -->
                  </div>


                   <div class="col-xl-4 col-lg-4 col-md-12">
                     <!-- Card -->
                     <div class="card mb-30">
                         <div class="card-body mb-xl-0">
                             <div class="title-content ">
                                 
                                 {% if total_members %}
                                 <h4 class="mb-2">Distribution of gender (Percent)</h4>
                                 {% else %}
                                 <h4 class="mb-2">No family members yet <a href="{% url 'tree' %}">added.</a></h4>
                                 {% endif %}
                             </div>
                             <div id="gender_pie_chart" class="d-flex flex-column align-items-start" 
                                 data-total-male="{{ total_male }}"
                                 data-total-female="{{ total_female }}"
                                 data-total-members="{{ total_members }}">
                              </div>
                              

                         </div>
                     </div>
                     <!-- End Card -->
                 </div>

                  <div class="col-xl-6 col-lg-12" >
                     <div class="row">
                        <div class="col-sm-6" >
                           <!-- Card -->
                           <div class="card mb-30" style="height: 315px;">
                              <div class="card-body">
                                  <div class="d-flex align-items-center mb-30">
                                      <div class="mr-3 square-75">
                                          <img src="{% static 'img/png-icon/gift.gif' %}" class="radius" alt="">
                                      </div>
                                      <div class="" style="margin-right: 40px;">
                                          <h4 class="mb-1">Birthdays</h4>
                                          <!-- <p class="font-14">Upcoming birthdays in the family</p> -->
                                          <!-- Adding condition -->
                                          {% if user_family_nodes %}
                                          <p class="font-14 mb-0">Total: {{ user_family_nodes.paginator.count }}</p>
                                          {% else %}
                                          <p class="font-14">No birthdays in the family <a href="{% url 'tree' %}">set</a> yet.</p>
                                          {% endif %}
                                      </div>

                                      <!-- Pagination -->
                                       <ul class="pagination justify-content-center" >
                                          {% if user_family_nodes.has_previous %}
                                          <!-- <li class="page-item">
                                             <a class="page-link" href="?page={{ user_family_nodes.previous_page_number }}">Previous</a>
                                          </li> -->
                                          {% endif %}
                                          {% for num in user_family_nodes.paginator.page_range %}
                                          <li class="page-item {% if num == user_family_nodes.number %}active{% endif %}">
                                             <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                          </li>
                                          {% endfor %}
                                          {% if user_family_nodes.has_next %}
                                          <!-- <li class="page-item">
                                             <a class="page-link" href="?page={{ user_family_nodes.next_page_number }}">Next</a>
                                          </li> -->
                                          {% endif %}
                                    </ul>
                                    <!-- End Pagination -->

                                      
                                  </div>
                          
                                  <div class="row">
                                      {% for user_family_node in user_family_nodes %}
                                      <div class="col-6">
                                          <div class="d-flex align-items-center mb-40">
                                              <div class="progress_8">
                                                  <!-- Progress Bar -->
                                                  <div class="ProgressBar-wrap2 position-relative">
                                                   <div class="ProgressBar ProgressBar_8" data-progress="67">
                                                       <svg class="ProgressBar-contentCircle" viewBox="0 0 200 200">
                                                           <!-- Define the angle and center of rotation of the circle -->
                                                           <circle transform="rotate(-90, 100, 100)" class="ProgressBar-background" cx="100" cy="100" r="85" />
                                                           <!-- Add the number of days inside the circle -->
                                                           <text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" font-size="64" fill="#000" font-weight="bold">{{ user_family_node.days_until_birthday }}</text>
                                                           <circle transform="rotate(-90, 100, 100)" class="ProgressBar-circle" cx="100" cy="100" r="85" />
                                                       </svg>
                                                   </div>
                                               </div>
                                               
                                                  <!-- End Progress Bar -->
                                              </div>
                                              <div class="">
                                                  <p class="mb-1 font-14 l-height1">{{ user_family_node.name }}</p>
                                                  <h5>{{ user_family_node.date_of_birth }}</h5>
                                              </div>
                                          </div>
                                      </div>
                                      {% endfor %}
                                      
                                  </div>
                                  
                                  
                              </div>
                          </div>
                          
                           <!-- End Card -->
                        </div>
      
                        <div class="col-sm-6">
                           <!-- Card -->
                           <div class="card" style="width: 170%; height: 90%;">
                              <div class="card-body">
                                  <div class="d-flex">
                                    <div class="increase ml-3">
                                       <div class="card-title d-flex align-items-end mb-2">
                                           {% if personal_info.days_until_birthday %}
                                               <h2>{{ personal_info.days_until_birthday }}<sup>days</sup></h2>
                                               <p class="font-10">left</p>
                                           {% else %}
                                               <h3>No birthday date set for {{ user.first_name }}</h3>
                                           {% endif %}
                                       </div>
                                       <h3 class="card-subtitle mb-2" style="white-space: nowrap;">Birthday Reminder</h3>
                                       {% if personal_info.days_until_birthday %}
                                           <p class="font-16">Your birthday is coming up soon! Make sure to celebrate.</p>
                                           <p class="font-16">Your age: <b>{{ personal_info.age }}</b></p>
                                           <p class="font-16">Date of Birth: <b>{{ personal_info.birth_date }}</b></p>
                                       {% else %}
                                           <p class="font-16"><a href="{% url 'edit_profile' %}">Set your date</a> to see how many days are left until your birthday.</p>
                                       {% endif %}
                                   </div>
                                   
                                      <div class="congratulation-img" style="margin-left: 150px; width: 20%;">
                                          <img src="{% static 'img/png-icon/birthday.gif' %}"  alt="Congratulations Image">
                                      </div>
                                  </div>
                              </div>
                          </div>
                          
                           <!-- End Card -->
                        </div>
                     </div>
                  </div>

                  <div class="col-xl-12">
                     <!-- Card -->
                     <div class="card">
                        <div class="card-body pb-0">
                           <div class="d-flex justify-content-between">
                              <div class="title-content mb-4">
                                 <h4 class="mb-2">Tree Data</h4>
                                 <p class="font-14">This is the data of the family tree</p>
                              </div>
                           </div>
                        </div>
                              
                        <div class="table-responsive">
                           <table class="style--three table-centered text-nowrap">
                              
                              <thead>
                                 <tr>
                                    <!-- <th class="text-center">Relation</th> -->
                                    <th class="text-center">Name</th>
                                    <th class="text-center">Surname</th>
                                    <th class="text-center">Email</th>
                                    <th class="text-center">Phone</th>
                                    <th class="text-center">Gender</th>
                                    <th class="text-center">Special Event</th>
                                    <th class="text-center">Created At</th>
                                    <th class="text-center">Updated At</th>
                                    <th class="text-center">Other Comments</th>
                                 </tr>
                             </thead>
                             <tbody>
                                 {% for user_family_node in user_family_nodes %}
                                 <tr>
                                    <!-- <td class="text-center">{{ user_family_node.relationship }}</td> -->
                                    <td class="text-center">{{ user_family_node.name }}</td>
                                    <td class="text-center">{{ user_family_node.surname }}</td>
                                    <td class="text-center">{{ user_family_node.email }}</td>
                                    <td class="text-center">{{ user_family_node.phone }}</td>
                                    <td class="text-center">{{ user_family_node.gender }}</td>
                                    <td class="text-center">{{ user_family_node.special_event }}</td>
                                    <td class="text-center">{{ user_family_node.created_at }}</td>
                                    <td class="text-center">{{ user_family_node.updated_at }}</td>
                                    <td class="text-center">{{ user_family_node.other_comments }}</td>
                                 </tr>
                                 {% endfor %}

                              </tbody>
                           </table>
                        </div>
                     </div>
                     <!-- End Card -->
                  </div>
               </div>
            </div>
         </div>
         <!-- End Main Content -->
      </div>
      <!-- End Main Wrapper -->

      <!-- Footer -->
      {% include 'core/partials/footer.html' %}
      <!-- End Footer -->
   </div>
   <!-- End wrapper -->

   <!-- ======= BEGIN GLOBAL MANDATORY SCRIPTS ======= -->
   <script src="{% static 'js/jquery.min.js' %}"></script>
   <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
   <script src="{% static 'plugins/perfect-scrollbar/perfect-scrollbar.min.js' %}"></script>
   <script src="{% static 'js/script.js' %}"></script>
   <!-- ======= BEGIN GLOBAL MANDATORY SCRIPTS ======= -->

   <!-- ======= BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS ======= -->
   <script src="{% static 'plugins/apex/apexcharts.min.js' %}"></script>
   <script src="{% static 'plugins/apex/custom-apexcharts.js' %}"></script>
   <!-- ======= End BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS ======= -->

   <script src="{% static 'js/customGender.js' %}" ></script>
</body>

</html>